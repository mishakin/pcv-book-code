<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_smooth_dem_robust_bilinear_square</title>
  <meta name="keywords" content="test_smooth_dem_robust_bilinear_square">
  <meta name="description" content="% test dem smoothing">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../Documentation.html">Home</a> &gt;  <a href="#">16-Surface-Reconstruction</a> &gt; <a href="../Documentation.html">Surface-Reconstruction</a> &gt; <a href="Documentation.html">Functions</a> &gt; test_smooth_dem_robust_bilinear_square.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../Documentation.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="Documentation.html">Index for 16-Surface-Reconstruction\Surface-Reconstruction\Functions&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>test_smooth_dem_robust_bilinear_square
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% test dem smoothing</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% test dem smoothing</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="interpolate_bilinear.html" class="code" title="function z=interpolate_bilinear(S,x,y,dx,BB,sigma_h);">interpolate_bilinear</a>	% interpolate_bilinear</li><li><a href="simulate_points_dem_0.html" class="code" title="function [points,BB,dx,sigma_k,sigma_h,out_in,dem]=simulate_points_dem_0">simulate_points_dem_0</a>	% generate a set of points for dem-interpolation</li><li><a href="simulate_points_dem_0_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,dem,out_in]=simulate_points_dem_0(dx)">simulate_points_dem_0_flat</a>	% generate a set of points for dem-interpolation</li><li><a href="simulate_points_dem_10.html" class="code" title="function [points,BB,delta_x,sigma_k,XYZ_ori]=simulate_points_dem_10(file_name,Nbin)">simulate_points_dem_10</a>	% read ply-file</li><li><a href="simulate_points_dem_15_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,out_in,dem]=simulate_points_dem_15(d,n)">simulate_points_dem_15_flat</a>	% generate a set of points for dem-interpolation</li><li><a href="simulate_points_dem_6.html" class="code" title="function [points,BB,delta_x,sigma_k,out_in,dem] =simulate_points_dem_6(N,g_min,delta_g,sigma,outlier_percentage)">simulate_points_dem_6</a>	% simulate_points_dem_6: generate test image of Uwe 1994</li><li><a href="simulate_points_dem_square.html" class="code" title="function [points,BB,dx,sigma_k,sigma_h,oi,dem]=simulate_points_dem_square">simulate_points_dem_square</a>	% generate a set of points for dem-interpolation</li><li><a href="smooth_dem_robust_bilinear.html" class="code" title="function [dem_smoothed,S,Sigma,Np,Nr,Mc,v,A,weights,weights_f,W] =smooth_dem_robust_bilinear(points,BB,delta_x,sigma_k,out_C,type_robust,out_in_0,print_type,plot_type)">smooth_dem_robust_bilinear</a>	% smooth_dem_robust_bilinear</li><li><a href="../../../General-Functions/Statistics/init_rand_seed.html" class="code" title="function seed = init_rand_seed(seed)">init_rand_seed</a>	% init_rand_seed: initialize random number generation by specific seed</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% test dem smoothing</span>
0002 
0003 <span class="comment">% clear all</span>
0004 clearvars
0005 close all
0006 <span class="comment">% type_data: type of generated data</span>
0007 <span class="comment">% 0     a set of given points</span>
0008 <span class="comment">% 1     a roof parallel to the grid</span>
0009 <span class="comment">% 2     a roof skew to the grid</span>
0010 <span class="comment">% 3     a roof skew to the grid + a flat roof, points can be thinned out</span>
0011 <span class="comment">% 4     same as 3, but with points not sitting on a grid</span>
0012 <span class="comment">% 5     read an image</span>
0013 <span class="comment">% 6     Uwe's test image</span>
0014 <span class="comment">% 7     cake</span>
0015 <span class="comment">% 8     1/4 cake</span>
0016 <span class="comment">% 9     constant height with outliers</span>
0017 <span class="comment">% 10    read point cloud</span>
0018 <span class="comment">% 11    flat</span>
0019 <span class="comment">% 12    cone</span>
0020 <span class="comment">% 13    cake</span>
0021 <span class="comment">% 14    flat with outliers</span>
0022 <span class="comment">% 15    flat 4x4 points</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% wf 7/2014</span>
0025 
0026 init_rand = 6;
0027 type_data = 16;
0028 type_robust = 0
0029 <span class="comment">%             0 not robust</span>
0030 <span class="comment">%             1 only dem</span>
0031 <span class="comment">%             2 only points</span>
0032 <span class="comment">%             3 both</span>
0033 
0034 out_C = 0;
0035 out_print = 0;
0036 print_type = 0;
0037 plot_type  = 0;
0038 Tol =0.15;
0039 
0040 <a href="../../../General-Functions/Statistics/init_rand_seed.html" class="code" title="function seed = init_rand_seed(seed)">init_rand_seed</a>(init_rand);
0041 
0042 
0043 <span class="comment">%% generate dem point cloud</span>
0044 <span class="keyword">switch</span> type_data
0045     <span class="keyword">case</span> 0
0046         [points,BB,delta_x,sigma_k,sigma_h,dem]=<a href="simulate_points_dem_0.html" class="code" title="function [points,BB,dx,sigma_k,sigma_h,out_in,dem]=simulate_points_dem_0">simulate_points_dem_0</a>
0047         out_in =ones(size(points),1);
0048     <span class="keyword">case</span> 1
0049         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_1;
0050     <span class="keyword">case</span> 2
0051         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_2;       
0052     <span class="keyword">case</span> 3
0053         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_3;
0054     <span class="keyword">case</span> 4
0055         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_4;
0056     <span class="keyword">case</span> 5
0057         im_name = <span class="string">'IMG_2092_4.JPG'</span>; 
0058         im_name = <span class="string">'IMG_2726-2.JPG'</span>;  
0059         im_name = <span class="string">'IMG_8004-4.JPG'</span>;   
0060         <span class="comment">% im_name = 'IMG_2425-2.JPG';  % Figur Paris</span>
0061         <span class="comment">%im_name = 'IMG_5977-4.JPG'; % Zebra</span>
0062         <span class="comment">%im_name = 'IMG_7452-4.JPG'; % Katze</span>
0063         im_name = <span class="string">'IMG_8942-4.JPG'</span>; <span class="comment">% Fassade Prag</span>
0064         [points,BB,delta_x,sigma_k,sigma_h,dem]=simulate_points_dem_5(im_name);
0065      <span class="keyword">case</span> 6
0066         [points,BB,delta_x,sigma_k,sigma_s,sigma_h,out_in,dem]=<a href="simulate_points_dem_6.html" class="code" title="function [points,BB,delta_x,sigma_k,out_in,dem] =simulate_points_dem_6(N,g_min,delta_g,sigma,outlier_percentage)">simulate_points_dem_6</a>(70,10,10,1,0.05);
0067         [points,BB,delta_x,sigma_k,sigma_s,sigma_h,out_in,dem]=<a href="simulate_points_dem_6.html" class="code" title="function [points,BB,delta_x,sigma_k,out_in,dem] =simulate_points_dem_6(N,g_min,delta_g,sigma,outlier_percentage)">simulate_points_dem_6</a>(70,10,10,0.5,0.05);
0068     <span class="keyword">case</span> 7
0069         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_7(30,15,15,1);
0070         dem0=dem;
0071      <span class="keyword">case</span> 8
0072         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_8(10,15,15,1);
0073         dem0=dem;
0074      <span class="keyword">case</span> 9
0075          sigma=0.001;
0076         [points,BB,delta_x,sigma_k,dem,out_in,dz]=simulate_points_dem_9(2000,0.15,sigma);
0077         dem0=dem;
0078      <span class="keyword">case</span> 10
0079         [points,BB,delta_x,sigma_k,XYZo]=<span class="keyword">...</span>
0080             <a href="simulate_points_dem_10.html" class="code" title="function [points,BB,delta_x,sigma_k,XYZ_ori]=simulate_points_dem_10(file_name,Nbin)">simulate_points_dem_10</a>(<span class="string">'fa2_aurelo_result_pyra0_ausgeschnitten-3.ply'</span>,40);
0081         
0082     <span class="keyword">case</span> 11
0083         [points,BB,delta_x,sigma_k,sigma_s,dem]=<a href="simulate_points_dem_0_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,dem,out_in]=simulate_points_dem_0(dx)">simulate_points_dem_0_flat</a>
0084     <span class="keyword">case</span> 12
0085         [points,BB,delta_x,sigma_k,sigma_s,dem]=simulate_points_dem_cone
0086     <span class="keyword">case</span> 13
0087         [points,BB,delta_x,sigma_k,sigma_s,dem]=simulate_points_dem_steps(60,4,5)
0088     <span class="keyword">case</span> 14
0089          sigma=0.001;
0090         [points,BB,delta_x,sigma_k,dem,out_in,dem]=simulate_points_dem_14(2000,0.15,sigma);
0091         dem0=dem;
0092     
0093     <span class="keyword">case</span> 15
0094         d=8;
0095         n=4;
0096         [points,BB,delta_x,sigma_k,sigma_s,out_in,dem]=<a href="simulate_points_dem_15_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,out_in,dem]=simulate_points_dem_15(d,n)">simulate_points_dem_15_flat</a>(d,n)        
0097         out_C = 1;
0098     <span class="keyword">case</span> 16
0099         [points,BB,delta_x,sigma_k,sigma_s,out_in,dem]=<a href="simulate_points_dem_square.html" class="code" title="function [points,BB,dx,sigma_k,sigma_h,oi,dem]=simulate_points_dem_square">simulate_points_dem_square</a>  
0100 <span class="keyword">end</span>
0101 
0102 Np = size(points,1);
0103 
0104 
0105 <span class="comment">%% interpolate</span>
0106 
0107 starttime = cputime
0108 [ds,S,Sigma,Np,Nr,Mc,ver,A,w,w_f,W] =<span class="keyword">...</span>
0109     <a href="smooth_dem_robust_bilinear.html" class="code" title="function [dem_smoothed,S,Sigma,Np,Nr,Mc,v,A,weights,weights_f,W] =smooth_dem_robust_bilinear(points,BB,delta_x,sigma_k,out_C,type_robust,out_in_0,print_type,plot_type)">smooth_dem_robust_bilinear</a><span class="keyword">...</span>
0110     (points,BB,delta_x,sigma_k,out_C,type_robust,type_data,<span class="keyword">...</span>
0111     out_in,print_type,plot_type)
0112 complete_time_for_solution=cputime-starttime
0113     
0114 <span class="comment">% figure</span>
0115 <span class="comment">%        sc = max(ds(:))-min(ds(:));</span>
0116 <span class="comment">%        imshow((ds-min(ds(:)))/sc*0.95);</span>
0117 <span class="comment">%</span>
0118 <span class="comment">% if out_C &gt; 0</span>
0119 <span class="comment">%     figure</span>
0120 <span class="comment">%     f=max(S(:));</span>
0121 <span class="comment">%     mesh(sqrt(S/f*min(Nr,Mc)/3)*10)</span>
0122 <span class="comment">%     hold on</span>
0123 <span class="comment">%     title('standard deviations')</span>
0124 <span class="comment">%     if type_data ~= 5</span>
0125 <span class="comment">%         axis equal</span>
0126 <span class="comment">%     end</span>
0127 <span class="comment">% end</span>
0128 <span class="comment">%%</span>
0129 figure
0130 hold on
0131 X=([0:Nr-1]'*ones(1,Mc))*delta_x+BB(1);
0132 Y=(ones(Nr,1)*[0:Mc-1])*delta_x+BB(2);
0133 
0134 <span class="keyword">if</span> type_data ~= 5
0135    colormap(gray)
0136     shade = [-1 0; 0 1]/sqrt(2);
0137     shade = -[ 0 -1; 1 0]/sqrt(2);
0138     col=conv2(ds,shade,<span class="string">'same'</span>);
0139     <span class="comment">%col=(1+col./sqrt(1+col.^2))/2;</span>
0140     colo=min(1, max(0,tanh(100*(col-0)/(max(col(:))-min(col(:))))));
0141     surf(X,Y,ds,colo,<span class="string">'FaceLighting'</span>,<span class="string">'gouraud'</span>,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>)
0142     alpha(0.3);
0143     shading interp 
0144     <span class="comment">%mesh(X,Y,ds);</span>
0145     
0146     plot3(points(:,1),points(:,2),points(:,3),<span class="string">'.r'</span>,<span class="string">'MarkerSize'</span>,15)
0147     view=[-20,30]
0148 <span class="keyword">else</span>
0149     figure <span class="comment">%subplot(1,3,3)</span>
0150     <span class="comment">%imagesc([dem,ds])</span>
0151     imshow([dem,ds])
0152     colormap(gray)
0153 <span class="keyword">end</span>
0154 
0155 title(<span class="string">'fitted dem with given points'</span>)
0156        
0157 <span class="keyword">if</span> type_data ~= 5
0158     axis equal
0159 <span class="keyword">end</span>
0160 <span class="comment">%%</span>
0161 figure
0162 <span class="keyword">if</span> type_data == 0
0163     subplot(1,2,1)
0164 
0165     hold on
0166     surf(X,Y,ds); <span class="comment">%,'EdgeColor',[0,0,0])% ,129*ones(size(S))</span>
0167     colormap(gray)
0168 
0169     title(<span class="string">'fitted dem - min gradient'</span>)
0170     alpha(0.3)
0171     col=zeros(Np,2);
0172     <span class="keyword">for</span> n=1:Np
0173         plot3(points(n,1),points(n,2),points(n,3),<span class="string">'.k'</span>,<span class="string">'MarkerSize'</span>,15)
0174     <span class="keyword">end</span>
0175     view([-29,65])
0176     xlim([BB(1),BB(3)])
0177     ylim([BB(2),BB(4)])
0178     zlim([0,10])
0179     axis equal
0180 
0181     subplot(1,2,2)
0182     hold on
0183     surf(X,Y,sqrt(S)*sigma_h,<span class="string">'EdgeColor'</span>,[0,0,0])
0184     colormap(cool);
0185     title(<span class="string">'fitted dem - sigmas'</span>)
0186     col=zeros(Np,2);
0187     alpha(0.3)
0188     <span class="keyword">for</span> n=1:Np
0189         z=<a href="interpolate_bilinear.html" class="code" title="function z=interpolate_bilinear(S,x,y,dx,BB,sigma_h);">interpolate_bilinear</a>(S,points(n,1),points(n,2),delta_x,BB,sigma_h);
0190         plot3(points(n,1),points(n,2),z,<span class="string">'.k'</span>,<span class="string">'MarkerSize'</span>,15)
0191     <span class="keyword">end</span>
0192     plot3(0,0,0,<span class="string">'.k'</span>)
0193     view([-29,65])
0194     xlim([BB(1),BB(3)])
0195     ylim([BB(2),BB(4)])
0196     zlim([-1,7])
0197     axis equal
0198 
0199 <span class="keyword">end</span>
0200 
0201 <span class="comment">%%</span>
0202 
0203 figure
0204 
0205 mesh(ds,<span class="string">'EdgeColor'</span>,[0,0,0])
0206 axis equal
0207         view([-33,63])
0208         zlim([-30,70])
0209 grid off
0210 <span class="comment">%%</span>
0211 <span class="comment">% figure</span>
0212 <span class="comment">% hold on</span>
0213 <span class="comment">% mesh_edge_color(ds)</span>
0214 <span class="comment">% view([-68,57])</span>
0215 <span class="comment">% axis equal</span>
0216 
0217 <span class="comment">%plot_edges_dem(Np, Nr, Mc, points, out_in, w, w_f, Tol);</span>
0218 <span class="comment">% for p=1:Np</span>
0219 <span class="comment">%     if out_in(p)</span>
0220 <span class="comment">%         [p,points(p,1),points(p,2),w(p),w_f(p),abs(dz(p))/(3*sigma)];</span>
0221 <span class="comment">%     end</span>
0222 <span class="comment">% end</span>
0223 
0224 
0225 figure
0226 hold on
0227 mesh(S);
0228 title(<span class="string">'Heigh \sigma_z'</span>)
0229 view([-33,63])
0230 sigma_centre=S(1+(n-1)*d,1+(n-1)*d)
0231 <span class="keyword">return</span> 
0232 <span class="comment">%%</span>
0233 <span class="keyword">if</span> type_data ~= 5 
0234         axis equal
0235 <span class="keyword">end</span>
0236 figure
0237 imagesc(ds-dem)
0238 colormap(gray)
0239 
0240 figure
0241 mesh(ds-dem)
0242 colormap(gray)
0243 
0244 full(inv(W)*A);
0245 
0246 figure
0247 mesh(ds)
0248 colormap(gray);
0249 axis equal
0250 
0251 number_of_outliers = sum(out_in)
0252 
0253 
0254 <span class="keyword">return</span>
0255 <span class="comment">%%</span>
0256 <span class="keyword">if</span> type_data == 1
0257     Icc = Np;                    <span class="comment">% first index for column curvatures</span>
0258     Irr = Np + (Nr-2)*Mc;        <span class="comment">% first index for row curvature</span>
0259     Irc = Np + (Nr-2)*Mc + Nr*(Mc-2);    <span class="comment">% first index for torsion</span>
0260     <span class="comment">% plot residuals</span>
0261     figure
0262     <span class="comment">% heights</span>
0263     subplot(1,4,1)
0264     res=zeros(Nr,Mc);
0265     vg = reshape(ver(1:Np),Nr-2,Mc-2);
0266     <span class="keyword">for</span> i=1:Nr-2
0267         <span class="keyword">for</span> j=1:Mc-2
0268             res(i+1,j+1)=vg(i,j);
0269         <span class="keyword">end</span>
0270     <span class="keyword">end</span>
0271     mesh(-res(:)');
0272     title(<span class="string">'residuals - heights'</span>)
0273     
0274     <span class="comment">% curvatures cc</span>
0275     subplot(1,4,2)
0276     res=zeros(Nr,Mc);
0277     vg = reshape(ver(Icc+1:Irr),Nr-2,Mc);
0278     <span class="keyword">for</span> i=1:Nr-2
0279         <span class="keyword">for</span> j=1:Mc
0280             res(i+1,j)=vg(i,j);
0281         <span class="keyword">end</span>
0282     <span class="keyword">end</span>
0283     mesh(-res'*sqrt(sigma_k));
0284     title(<span class="string">'residuals - curvatures cc'</span>)
0285     
0286     <span class="comment">% curvatures rr</span>
0287     
0288     subplot(1,4,3)
0289     res=zeros(Nr,Mc);
0290     vg = reshape(ver(Irr+1:Irc),Nr,Mc-2);
0291     <span class="keyword">for</span> i=1:Nr
0292         <span class="keyword">for</span> j=1:Mc-2
0293             res(i,j+1)=vg(i,j);
0294         <span class="keyword">end</span>
0295     <span class="keyword">end</span>
0296     mesh(-res'*sqrt(sigma_k));
0297     title(<span class="string">'residuals - curvatures rr'</span>)
0298     
0299     <span class="comment">% torsion rc</span>
0300     
0301     subplot(1,4,4)
0302     res=zeros(Nr,Mc);
0303     vg = reshape(ver(Irc+1:end),Nr-1,Mc-1);
0304     <span class="keyword">for</span> i=1:Nr-1
0305         <span class="keyword">for</span> j=1:Mc-1
0306             res(i,j)=vg(i,j);
0307         <span class="keyword">end</span>
0308     <span class="keyword">end</span>
0309     mesh(-res'*sqrt(sigma_k));
0310     title(<span class="string">'residuals - torsion rc'</span>)
0311 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 21-Jul-2018 20:56:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>