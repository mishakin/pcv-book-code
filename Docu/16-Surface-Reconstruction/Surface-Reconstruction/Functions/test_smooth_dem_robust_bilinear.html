<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_smooth_dem_robust_bilinear</title>
  <meta name="keywords" content="test_smooth_dem_robust_bilinear">
  <meta name="description" content="% test dem smoothing">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../Documentation.html">Home</a> &gt;  <a href="#">16-Surface-Reconstruction</a> &gt; <a href="../Documentation.html">Surface-Reconstruction</a> &gt; <a href="Documentation.html">Functions</a> &gt; test_smooth_dem_robust_bilinear.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../Documentation.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="Documentation.html">Index for 16-Surface-Reconstruction\Surface-Reconstruction\Functions&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>test_smooth_dem_robust_bilinear
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% test dem smoothing</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% test dem smoothing</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="interpolate_bilinear.html" class="code" title="function z=interpolate_bilinear(S,x,y,dx,BB,sigma_h);">interpolate_bilinear</a>	% interpolate_bilinear</li><li><a href="simulate_points_dem_0.html" class="code" title="function [points,BB,dx,sigma_k,sigma_h,out_in,dem]=simulate_points_dem_0">simulate_points_dem_0</a>	% generate a set of points for dem-interpolation</li><li><a href="simulate_points_dem_0_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,dem,out_in]=simulate_points_dem_0(dx)">simulate_points_dem_0_flat</a>	% generate a set of points for dem-interpolation</li><li><a href="simulate_points_dem_10.html" class="code" title="function [points,BB,delta_x,sigma_k,XYZ_ori]=simulate_points_dem_10(file_name,Nbin)">simulate_points_dem_10</a>	% read ply-file</li><li><a href="simulate_points_dem_15_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,out_in,dem]=simulate_points_dem_15(d,n)">simulate_points_dem_15_flat</a>	% generate a set of points for dem-interpolation</li><li><a href="simulate_points_dem_6.html" class="code" title="function [points,BB,delta_x,sigma_k,out_in,dem] =simulate_points_dem_6(N,g_min,delta_g,sigma,outlier_percentage)">simulate_points_dem_6</a>	% simulate_points_dem_6: generate test image of Uwe 1994</li><li><a href="smooth_dem_robust_bilinear.html" class="code" title="function [dem_smoothed,S,Sigma,Np,Nr,Mc,v,A,weights,weights_f,W] =smooth_dem_robust_bilinear(points,BB,delta_x,sigma_k,out_C,type_robust,out_in_0,print_type,plot_type)">smooth_dem_robust_bilinear</a>	% smooth_dem_robust_bilinear</li><li><a href="../../../General-Functions/Statistics/init_rand_seed.html" class="code" title="function seed = init_rand_seed(seed)">init_rand_seed</a>	% init_rand_seed: initialize random number generation by specific seed</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% test dem smoothing</span>
0002 
0003 <span class="comment">% clear all</span>
0004 clearvars
0005 close all
0006 <span class="comment">% type_data: type of generated data</span>
0007 <span class="comment">% 0     a set of given points</span>
0008 <span class="comment">% 1     a roof parallel to the grid</span>
0009 <span class="comment">% 2     a roof skew to the grid</span>
0010 <span class="comment">% 3     a roof skew to the grid + a flat roof, points can be thinned out</span>
0011 <span class="comment">% 4     same as 3, but with points not sitting on a grid</span>
0012 <span class="comment">% 5     read an image</span>
0013 <span class="comment">% 6     Uwe's test image</span>
0014 <span class="comment">% 7     cake</span>
0015 <span class="comment">% 8     1/4 cake</span>
0016 <span class="comment">% 9     constant height with outliers</span>
0017 <span class="comment">% 10    read point cloud</span>
0018 <span class="comment">% 11    flat</span>
0019 <span class="comment">% 12    cone</span>
0020 <span class="comment">% 13    cake</span>
0021 <span class="comment">% 14    flat with outliers</span>
0022 <span class="comment">% 15    flat 4x4 points</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% wf 7/2014</span>
0025 
0026 init_rand = 6;
0027 type_data = 0;
0028 type_robust = 0
0029 <span class="comment">%             0 not robust</span>
0030 <span class="comment">%             1 only dem</span>
0031 <span class="comment">%             2 only points</span>
0032 <span class="comment">%             3 both</span>
0033 
0034 out_C = 0;
0035 out_print = 0;
0036 print_type = 0;
0037 plot_type  = 0;
0038 Tol =0.15;
0039 
0040 <a href="../../../General-Functions/Statistics/init_rand_seed.html" class="code" title="function seed = init_rand_seed(seed)">init_rand_seed</a>(init_rand);
0041 
0042 
0043 <span class="comment">%% generate dem point cloud</span>
0044 <span class="keyword">switch</span> type_data
0045     <span class="keyword">case</span> 0
0046         [points,BB,delta_x,sigma_k,sigma_h,dem]=<a href="simulate_points_dem_0.html" class="code" title="function [points,BB,dx,sigma_k,sigma_h,out_in,dem]=simulate_points_dem_0">simulate_points_dem_0</a>
0047         out_in =ones(size(points),1);
0048     <span class="keyword">case</span> 1
0049         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_1;
0050     <span class="keyword">case</span> 2
0051         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_2;       
0052     <span class="keyword">case</span> 3
0053         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_3;
0054     <span class="keyword">case</span> 4
0055         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_4;
0056     <span class="keyword">case</span> 5
0057         im_name = <span class="string">'IMG_2092_4.JPG'</span>; 
0058         im_name = <span class="string">'IMG_2726-2.JPG'</span>;  
0059         im_name = <span class="string">'IMG_8004-4.JPG'</span>;   
0060         <span class="comment">% im_name = 'IMG_2425-2.JPG';  % Figur Paris</span>
0061         <span class="comment">%im_name = 'IMG_5977-4.JPG'; % Zebra</span>
0062         <span class="comment">%im_name = 'IMG_7452-4.JPG'; % Katze</span>
0063         im_name = <span class="string">'IMG_8942-4.JPG'</span>; <span class="comment">% Fassade Prag</span>
0064         [points,BB,delta_x,sigma_k,sigma_h,dem]=simulate_points_dem_5(im_name);
0065      <span class="keyword">case</span> 6
0066         [points,BB,delta_x,sigma_k,sigma_s,sigma_h,out_in,dem]=<a href="simulate_points_dem_6.html" class="code" title="function [points,BB,delta_x,sigma_k,out_in,dem] =simulate_points_dem_6(N,g_min,delta_g,sigma,outlier_percentage)">simulate_points_dem_6</a>(70,10,10,1,0.05);
0067         [points,BB,delta_x,sigma_k,sigma_s,sigma_h,out_in,dem]=<a href="simulate_points_dem_6.html" class="code" title="function [points,BB,delta_x,sigma_k,out_in,dem] =simulate_points_dem_6(N,g_min,delta_g,sigma,outlier_percentage)">simulate_points_dem_6</a>(70,10,10,0.5,0.05);
0068     <span class="keyword">case</span> 7
0069         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_7(30,15,15,1);
0070         dem0=dem;
0071      <span class="keyword">case</span> 8
0072         [points,BB,delta_x,sigma_k,dem]=simulate_points_dem_8(10,15,15,1);
0073         dem0=dem;
0074      <span class="keyword">case</span> 9
0075          sigma=0.001;
0076         [points,BB,delta_x,sigma_k,dem,out_in,dz]=simulate_points_dem_9(2000,0.15,sigma);
0077         dem0=dem;
0078      <span class="keyword">case</span> 10
0079         [points,BB,delta_x,sigma_k,XYZo]=<span class="keyword">...</span>
0080             <a href="simulate_points_dem_10.html" class="code" title="function [points,BB,delta_x,sigma_k,XYZ_ori]=simulate_points_dem_10(file_name,Nbin)">simulate_points_dem_10</a>(<span class="string">'fa2_aurelo_result_pyra0_ausgeschnitten-3.ply'</span>,40);
0081         
0082     <span class="keyword">case</span> 11
0083         [points,BB,delta_x,sigma_k,sigma_s,dem]=<a href="simulate_points_dem_0_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,dem,out_in]=simulate_points_dem_0(dx)">simulate_points_dem_0_flat</a>
0084     <span class="keyword">case</span> 12
0085         [points,BB,delta_x,sigma_k,sigma_s,dem]=simulate_points_dem_cone
0086     <span class="keyword">case</span> 13
0087         [points,BB,delta_x,sigma_k,sigma_s,dem]=simulate_points_dem_steps(60,4,5)
0088     <span class="keyword">case</span> 14
0089          sigma=0.001;
0090         [points,BB,delta_x,sigma_k,dem,out_in,dem]=simulate_points_dem_14(2000,0.15,sigma);
0091         dem0=dem;
0092     
0093     <span class="keyword">case</span> 15
0094         d=8;
0095         n=4;
0096         [points,BB,delta_x,sigma_k,sigma_s,out_in,dem]=<a href="simulate_points_dem_15_flat.html" class="code" title="function [points,BB,dx,sigma_k,sigma_s,out_in,dem]=simulate_points_dem_15(d,n)">simulate_points_dem_15_flat</a>(d,n)        
0097         out_C = 1;
0098 <span class="keyword">end</span>
0099 
0100 Np = size(points,1);
0101 
0102 
0103 <span class="comment">%% interpolate</span>
0104 
0105 starttime = cputime
0106 [ds,S,Sigma,Np,Nr,Mc,ver,A,w,w_f,W] =<span class="keyword">...</span>
0107     <a href="smooth_dem_robust_bilinear.html" class="code" title="function [dem_smoothed,S,Sigma,Np,Nr,Mc,v,A,weights,weights_f,W] =smooth_dem_robust_bilinear(points,BB,delta_x,sigma_k,out_C,type_robust,out_in_0,print_type,plot_type)">smooth_dem_robust_bilinear</a><span class="keyword">...</span>
0108     (points,BB,delta_x,sigma_k,out_C,type_robust,type_data,<span class="keyword">...</span>
0109     out_in,print_type,plot_type)
0110 complete_time_for_solution=cputime-starttime
0111     
0112 <span class="comment">% figure</span>
0113 <span class="comment">%        sc = max(ds(:))-min(ds(:));</span>
0114 <span class="comment">%        imshow((ds-min(ds(:)))/sc*0.95);</span>
0115 <span class="comment">%</span>
0116 <span class="comment">% if out_C &gt; 0</span>
0117 <span class="comment">%     figure</span>
0118 <span class="comment">%     f=max(S(:));</span>
0119 <span class="comment">%     mesh(sqrt(S/f*min(Nr,Mc)/3)*10)</span>
0120 <span class="comment">%     hold on</span>
0121 <span class="comment">%     title('standard deviations')</span>
0122 <span class="comment">%     if type_data ~= 5</span>
0123 <span class="comment">%         axis equal</span>
0124 <span class="comment">%     end</span>
0125 <span class="comment">% end</span>
0126 <span class="comment">%%</span>
0127 figure
0128 hold on
0129 X=([0:Nr-1]'*ones(1,Mc))*delta_x+BB(1);
0130 Y=(ones(Nr,1)*[0:Mc-1])*delta_x+BB(2);
0131 
0132 <span class="keyword">if</span> type_data ~= 5
0133    colormap(gray)
0134     shade = [-1 0; 0 1]/sqrt(2);
0135     shade = -[ 0 -1; 1 0]/sqrt(2);
0136     col=conv2(ds,shade,<span class="string">'same'</span>);
0137     <span class="comment">%col=(1+col./sqrt(1+col.^2))/2;</span>
0138     colo=min(1, max(0,tanh(100*(col-0)/(max(col(:))-min(col(:))))));
0139     surf(X,Y,ds,colo,<span class="string">'FaceLighting'</span>,<span class="string">'gouraud'</span>,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>)
0140     alpha(0.3);
0141     shading interp 
0142     <span class="comment">%mesh(X,Y,ds);</span>
0143     
0144     plot3(points(:,1),points(:,2),points(:,3),<span class="string">'.r'</span>,<span class="string">'MarkerSize'</span>,15)
0145     view=[-20,30]
0146 <span class="keyword">else</span>
0147     figure <span class="comment">%subplot(1,3,3)</span>
0148     <span class="comment">%imagesc([dem,ds])</span>
0149     imshow([dem,ds])
0150     colormap(gray)
0151 <span class="keyword">end</span>
0152 
0153 title(<span class="string">'fitted dem with given points'</span>)
0154        
0155 <span class="keyword">if</span> type_data ~= 5
0156     axis equal
0157 <span class="keyword">end</span>
0158 <span class="comment">%%</span>
0159 figure
0160 <span class="keyword">if</span> type_data == 0
0161     subplot(1,2,1)
0162 
0163     hold on
0164     surf(X,Y,ds); <span class="comment">%,'EdgeColor',[0,0,0])% ,129*ones(size(S))</span>
0165     colormap(gray)
0166 
0167     title(<span class="string">'fitted dem - min gradient'</span>)
0168     alpha(0.3)
0169     col=zeros(Np,2);
0170     <span class="keyword">for</span> n=1:Np
0171         plot3(points(n,1),points(n,2),points(n,3),<span class="string">'.k'</span>,<span class="string">'MarkerSize'</span>,15)
0172     <span class="keyword">end</span>
0173     view([-29,65])
0174     xlim([BB(1),BB(3)])
0175     ylim([BB(2),BB(4)])
0176     zlim([0,10])
0177     axis equal
0178 
0179     subplot(1,2,2)
0180     hold on
0181     surf(X,Y,sqrt(S)*sigma_h,<span class="string">'EdgeColor'</span>,[0,0,0])
0182     colormap(cool);
0183     title(<span class="string">'fitted dem - sigmas'</span>)
0184     col=zeros(Np,2);
0185     alpha(0.3)
0186     <span class="keyword">for</span> n=1:Np
0187         z=<a href="interpolate_bilinear.html" class="code" title="function z=interpolate_bilinear(S,x,y,dx,BB,sigma_h);">interpolate_bilinear</a>(S,points(n,1),points(n,2),delta_x,BB,sigma_h);
0188         plot3(points(n,1),points(n,2),z,<span class="string">'.k'</span>,<span class="string">'MarkerSize'</span>,15)
0189     <span class="keyword">end</span>
0190     plot3(0,0,0,<span class="string">'.k'</span>)
0191     view([-29,65])
0192     xlim([BB(1),BB(3)])
0193     ylim([BB(2),BB(4)])
0194     zlim([-1,7])
0195     axis equal
0196 
0197 <span class="keyword">end</span>
0198 
0199 <span class="comment">%%</span>
0200 
0201 figure
0202 
0203 mesh(ds,<span class="string">'EdgeColor'</span>,[0,0,0])
0204 axis equal
0205         VIEW([-33,63])
0206         zlim([-30,70])
0207 grid off
0208 <span class="comment">%%</span>
0209 <span class="comment">% figure</span>
0210 <span class="comment">% hold on</span>
0211 <span class="comment">% mesh_edge_color(ds)</span>
0212 <span class="comment">% view([-68,57])</span>
0213 <span class="comment">% axis equal</span>
0214 
0215 <span class="comment">%plot_edges_dem(Np, Nr, Mc, points, out_in, w, w_f, Tol);</span>
0216 <span class="comment">% for p=1:Np</span>
0217 <span class="comment">%     if out_in(p)</span>
0218 <span class="comment">%         [p,points(p,1),points(p,2),w(p),w_f(p),abs(dz(p))/(3*sigma)];</span>
0219 <span class="comment">%     end</span>
0220 <span class="comment">% end</span>
0221 
0222 
0223 figure
0224 hold on
0225 mesh(S);
0226 title(<span class="string">'Heigh \sigma_z'</span>)
0227 view([-33,63])
0228 sigma_centre=S(1+(n-1)*d,1+(n-1)*d)
0229 <span class="keyword">return</span> 
0230 <span class="comment">%%</span>
0231 <span class="keyword">if</span> type_data ~= 5 
0232         axis equal
0233 <span class="keyword">end</span>
0234 figure
0235 imagesc(ds-dem)
0236 colormap(gray)
0237 
0238 figure
0239 mesh(ds-dem)
0240 colormap(gray)
0241 
0242 full(inv(W)*A);
0243 
0244 figure
0245 mesh(ds)
0246 colormap(gray);
0247 axis equal
0248 
0249 number_of_outliers = sum(out_in)
0250 
0251 
0252 <span class="keyword">return</span>
0253 <span class="comment">%%</span>
0254 <span class="keyword">if</span> type_data == 1
0255     Icc = Np;                    <span class="comment">% first index for column curvatures</span>
0256     Irr = Np + (Nr-2)*Mc;        <span class="comment">% first index for row curvature</span>
0257     Irc = Np + (Nr-2)*Mc + Nr*(Mc-2);    <span class="comment">% first index for torsion</span>
0258     <span class="comment">% plot residuals</span>
0259     figure
0260     <span class="comment">% heights</span>
0261     subplot(1,4,1)
0262     res=zeros(Nr,Mc);
0263     vg = reshape(ver(1:Np),Nr-2,Mc-2);
0264     <span class="keyword">for</span> i=1:Nr-2
0265         <span class="keyword">for</span> j=1:Mc-2
0266             res(i+1,j+1)=vg(i,j);
0267         <span class="keyword">end</span>
0268     <span class="keyword">end</span>
0269     mesh(-res(:)');
0270     title(<span class="string">'residuals - heights'</span>)
0271     
0272     <span class="comment">% curvatures cc</span>
0273     subplot(1,4,2)
0274     res=zeros(Nr,Mc);
0275     vg = reshape(ver(Icc+1:Irr),Nr-2,Mc);
0276     <span class="keyword">for</span> i=1:Nr-2
0277         <span class="keyword">for</span> j=1:Mc
0278             res(i+1,j)=vg(i,j);
0279         <span class="keyword">end</span>
0280     <span class="keyword">end</span>
0281     mesh(-res'*sqrt(sigma_k));
0282     title(<span class="string">'residuals - curvatures cc'</span>)
0283     
0284     <span class="comment">% curvatures rr</span>
0285     
0286     subplot(1,4,3)
0287     res=zeros(Nr,Mc);
0288     vg = reshape(ver(Irr+1:Irc),Nr,Mc-2);
0289     <span class="keyword">for</span> i=1:Nr
0290         <span class="keyword">for</span> j=1:Mc-2
0291             res(i,j+1)=vg(i,j);
0292         <span class="keyword">end</span>
0293     <span class="keyword">end</span>
0294     mesh(-res'*sqrt(sigma_k));
0295     title(<span class="string">'residuals - curvatures rr'</span>)
0296     
0297     <span class="comment">% torsion rc</span>
0298     
0299     subplot(1,4,4)
0300     res=zeros(Nr,Mc);
0301     vg = reshape(ver(Irc+1:end),Nr-1,Mc-1);
0302     <span class="keyword">for</span> i=1:Nr-1
0303         <span class="keyword">for</span> j=1:Mc-1
0304             res(i,j)=vg(i,j);
0305         <span class="keyword">end</span>
0306     <span class="keyword">end</span>
0307     mesh(-res'*sqrt(sigma_k));
0308     title(<span class="string">'residuals - torsion rc'</span>)
0309 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 21-Jul-2018 20:56:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>