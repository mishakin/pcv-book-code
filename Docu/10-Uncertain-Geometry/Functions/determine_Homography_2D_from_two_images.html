<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of determine_Homography_2D_from_two_images</title>
  <meta name="keywords" content="determine_Homography_2D_from_two_images">
  <meta name="description" content="demo_h_determine_homography_from_two_images: read/interactively determine homography">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../Documentation.html">Home</a> &gt;  <a href="../Documentation.html">10-Uncertain-Geometry</a> &gt; <a href="Documentation.html">Functions</a> &gt; determine_Homography_2D_from_two_images.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../Documentation.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="Documentation.html">Index for 10-Uncertain-Geometry\Functions&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>determine_Homography_2D_from_two_images
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>demo_h_determine_homography_from_two_images: read/interactively determine homography</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [H,X] = determine_Homography_2D_from_two_images(Image_l,Image_r,readX) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> demo_h_determine_homography_from_two_images: read/interactively determine homography

 [H,X,Cxx] = demo_h_determine_homography_from_two_images...
    (tau,sigma,sidth,sigma_n,Image_l,Image_r,coordinatesigma,coordinate_name,...
    ,magnification,readX);

 H homography from left to right
 X    = 4 x 4-matrix, rows control point coordinates
 Cxx  = 4 x 4 x 4 tensor with cov. matrices

 Wolfgang Förstner 06/18
 wfoerstn@uni-bonn.de</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../General-Functions/Graphics/plot_init.html" class="code" title="function varargout = plot_init">plot_init</a>	% plot_init: initialize visualization</li><li><a href="../../General-Functions/Graphics/plot_square_with_background.html" class="code" title="function plot_square_with_background(x,y,w,f1,f2)">plot_square_with_background</a>	% plot box with background</li><li><a href="../../General-Functions/SUGR/Homography_2D/sugr_Homography_2D.html" class="code" title="function Homography_2D = sugr_Homography_2D(a1,a2)">sugr_Homography_2D</a>	% create 2D homography</li><li><a href="../../General-Functions/SUGR/Homography_2D/sugr_estimation_algebraic_Homography_2D_from_point_pairs.html" class="code" title="function H = sugr_estimation_algebraic_Homography_2D_from_point_pairs(P)">sugr_estimation_algebraic_Homography_2D_from_point_pairs</a>	% Algebraic estimation of 2D homography from point pairs,</li><li><a href="../../General-Functions/SUGR/Homography_2D/sugr_estimation_ml_Homography_2D_from_point_pairs.html" class="code" title="function [H, sigma_0, R] = sugr_estimation_ml_Homography_2D_from_point_pairs(l, xa, T, maxiter)">sugr_estimation_ml_Homography_2D_from_point_pairs</a>	% ML estimate of 2D homography from point pairs</li><li><a href="../../General-Functions/SUGR/Homography_2D/sugr_transform_Homography_2D.html" class="code" title="function H = sugr_transform_Homography_2D(H0,Tl,Tr)">sugr_transform_Homography_2D</a>	% transform uncertain homography with crisp transformations</li><li><a href="../../General-Functions/SUGR/Homography_2D/sugr_transform_with_Homography_2D.html" class="code" title="function y = sugr_transform_with_Homography_2D(H,x)">sugr_transform_with_Homography_2D</a>	% transform uncertain elements using a projective mapping</li><li><a href="../../General-Functions/SUGR/Point_2D/sugr_Point_2D.html" class="code" title="function Point_2D = sugr_Point_2D(a1,a2,a3,a4)">sugr_Point_2D</a>	% Create 2D point</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../10-Uncertain-Geometry/Demo-Homography/demo_homography_from_two_images.html" class="code" title="">demo_homography_from_two_images</a>	% demo_function_homography_from_two_images:</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% demo_h_determine_homography_from_two_images: read/interactively determine homography</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% [H,X,Cxx] = demo_h_determine_homography_from_two_images...</span>
0004 <span class="comment">%    (tau,sigma,sidth,sigma_n,Image_l,Image_r,coordinatesigma,coordinate_name,...</span>
0005 <span class="comment">%    ,magnification,readX);</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% H homography from left to right</span>
0008 <span class="comment">% X    = 4 x 4-matrix, rows control point coordinates</span>
0009 <span class="comment">% Cxx  = 4 x 4 x 4 tensor with cov. matrices</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Wolfgang Förstner 06/18</span>
0012 <span class="comment">% wfoerstn@uni-bonn.de</span>
0013 
0014 <a name="_sub0" href="#_subfunctions" class="code">function [H,X] = determine_Homography_2D_from_two_images(</a><span class="keyword">...</span>
0015     Image_l,Image_r,readX)
0016 
0017 <span class="keyword">global</span> coordinate_sigma_x
0018 <span class="keyword">global</span> coordinate_name
0019 
0020 addpath(genpath(<span class="string">'../../General-Functions'</span>))
0021 ss = <a href="../../General-Functions/Graphics/plot_init.html" class="code" title="function varargout = plot_init">plot_init</a>;
0022 
0023 f1 = figure(<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'Name'</span>, <span class="string">'left image'</span>,<span class="string">'Position'</span>,[50,100,0.45*ss(1),0.45*ss(1)]);
0024 imshow(Image_l);
0025 hold on
0026 f2 = figure(<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'Name'</span>, <span class="string">'right image'</span>,<span class="string">'Position'</span>,[100+0.45*ss(1),100,0.45*ss(1),0.45*ss(1)]);
0027 imshow(Image_r);
0028 hold on
0029 
0030 <span class="keyword">if</span> readX == 0
0031     X = zeros(4,4);
0032     Cxx = zeros(4,4,4);
0033     <span class="keyword">for</span> n=1:4
0034         figure(f1)
0035         hold on
0036         disp(<span class="string">'measure point in left image (1)'</span>) 
0037         <span class="comment">%imagesc(Image_l);</span>
0038         <span class="comment">%% wait until a button is pressed</span>
0039         keydown = waitforbuttonpress;
0040         <span class="comment">% if a keyboard button was pressed, stop cycle</span>
0041         <span class="keyword">if</span> keydown == 1
0042             <span class="keyword">break</span>
0043         <span class="keyword">end</span>
0044         <span class="comment">%% grab mouse position</span>
0045         x = get(gca,<span class="string">'currentPoint'</span>);
0046         <span class="comment">% determina local accuracy</span>
0047         z = x(1,1:2)';
0048 
0049         Covl = coordinate_sigma_x*eye(2);
0050 
0051         <span class="comment">%% plot point in left image</span>
0052         <a href="../../General-Functions/Graphics/plot_square_with_background.html" class="code" title="function plot_square_with_background(x,y,w,f1,f2)">plot_square_with_background</a>(z(1),z(2),10);
0053         hold off
0054         
0055         X(n,1:2)= x(1,1:2);
0056 
0057         figure(f2)
0058         hold on
0059         
0060         disp(<span class="string">'measure corresponding point in right image (2)'</span>) 
0061         <span class="comment">%% wait until a button is pressed</span>
0062         keydown = waitforbuttonpress;
0063         <span class="comment">% if a keyboard button was pressed, stop cycle</span>
0064         <span class="keyword">if</span> keydown == 1
0065             <span class="keyword">break</span>
0066         <span class="keyword">end</span>
0067         <span class="comment">%% grab mouse position</span>
0068         x = get(gca,<span class="string">'currentPoint'</span>);
0069         z = x(1,1:2)';
0070         
0071         Covr = coordinate_sigma_x*eye(2);
0072 
0073         <span class="comment">%plot_square_with_background(x(1,1),x(1,2),10);</span>
0074         <a href="../../General-Functions/Graphics/plot_square_with_background.html" class="code" title="function plot_square_with_background(x,y,w,f1,f2)">plot_square_with_background</a>(z(1),z(2),10);
0075         X(n,3:4) = x(1,1:2);
0076 
0077         Cxx(n,:,:)= [Covl zeros(2);zeros(2) Covr];
0078     <span class="keyword">end</span>
0079 
0080     save(coordinate_name,<span class="string">'X'</span>,<span class="string">'Cxx'</span>);
0081 
0082 <span class="keyword">else</span>
0083     load(coordinate_name,<span class="string">'X'</span>,<span class="string">'Cxx'</span>);
0084 <span class="keyword">end</span>
0085 <span class="comment">% conditioning</span>
0086 Tl = <a href="../../General-Functions/SUGR/Homography_2D/sugr_Homography_2D.html" class="code" title="function Homography_2D = sugr_Homography_2D(a1,a2)">sugr_Homography_2D</a>(X(:,1:2));
0087 Tr = <a href="../../General-Functions/SUGR/Homography_2D/sugr_Homography_2D.html" class="code" title="function Homography_2D = sugr_Homography_2D(a1,a2)">sugr_Homography_2D</a>(X(:,3:4));
0088 <span class="keyword">for</span> n = 1 : 4
0089     pl = <a href="../../General-Functions/SUGR/Point_2D/sugr_Point_2D.html" class="code" title="function Point_2D = sugr_Point_2D(a1,a2,a3,a4)">sugr_Point_2D</a>(X(n,1:2)', squeeze(Cxx(n,1:2,1:2))); 
0090     pl = <a href="../../General-Functions/SUGR/Homography_2D/sugr_transform_with_Homography_2D.html" class="code" title="function y = sugr_transform_with_Homography_2D(H,x)">sugr_transform_with_Homography_2D</a>(Tl,pl);
0091     
0092     pr = <a href="../../General-Functions/SUGR/Point_2D/sugr_Point_2D.html" class="code" title="function Point_2D = sugr_Point_2D(a1,a2,a3,a4)">sugr_Point_2D</a>(X(n,3:4)', squeeze(Cxx(n,3:4,3:4))); 
0093     pr = <a href="../../General-Functions/SUGR/Homography_2D/sugr_transform_with_Homography_2D.html" class="code" title="function y = sugr_transform_with_Homography_2D(H,x)">sugr_transform_with_Homography_2D</a>(Tr,pr);
0094     <span class="comment">%</span>
0095     PPc.h(n,:)     = [pl.h', pr.h'];
0096     PPc.Crr(n,:,:) = [pl.Crr zeros(2);zeros(2) pr.Crr]; 
0097 <span class="keyword">end</span>
0098 
0099 <span class="comment">% estimation of H (conditioned)</span>
0100 Ha = <a href="../../General-Functions/SUGR/Homography_2D/sugr_estimation_algebraic_Homography_2D_from_point_pairs.html" class="code" title="function H = sugr_estimation_algebraic_Homography_2D_from_point_pairs(P)">sugr_estimation_algebraic_Homography_2D_from_point_pairs</a>(PPc);
0101 T = 0.1;
0102 maxiter = 3;
0103 [Hc,~,~] = <a href="../../General-Functions/SUGR/Homography_2D/sugr_estimation_ml_Homography_2D_from_point_pairs.html" class="code" title="function [H, sigma_0, R] = sugr_estimation_ml_Homography_2D_from_point_pairs(l, xa, T, maxiter)">sugr_estimation_ml_Homography_2D_from_point_pairs</a>(PPc,Ha,T,maxiter);
0104 
0105 <span class="comment">% uncondition xr = H xl,</span>
0106 <span class="comment">% Tr xr = (Tr H Tl^{-1} Tl) xl</span>
0107 <span class="comment">% H = inv(Tr) * H * Tl</span>
0108 H = <a href="../../General-Functions/SUGR/Homography_2D/sugr_transform_Homography_2D.html" class="code" title="function H = sugr_transform_Homography_2D(H0,Tl,Tr)">sugr_transform_Homography_2D</a>(Hc, inv(Tr.H), Tl.H);
0109</pre></div>
<hr><address>Generated on Sat 21-Jul-2018 20:56:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>