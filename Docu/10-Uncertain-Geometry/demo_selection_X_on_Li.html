<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of demo_selection_X_on_Li</title>
  <meta name="keywords" content="demo_selection_X_on_Li">
  <meta name="description" content="% test whether selection is necessary when using L through X constraint">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../Documentation.html">Home</a> &gt;  <a href="Documentation.html">10-Uncertain-Geometry</a> &gt; demo_selection_X_on_Li.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../Documentation.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="Documentation.html">Index for 10-Uncertain-Geometry&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>demo_selection_X_on_Li
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>% test whether selection is necessary when using L through X constraint</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">% test whether selection is necessary when using L through X constraint
 Result: they differ, but not statistically significant

 Case o: no selection
 Case m: with selection

 Method
 1. Generate true values for X and three L_i = X \wedge Y_i
 2. Derive theoretical covariance matrix for both cases
 3. Generate N_iter samples with random perturbations
 4. Determine solution for both cases
 5. determine empirical covariance matrix for both cases
 6. Statistically test empirical vs. theoretical covariance matrix

 Wolfgang Förstner
 wfoerstn@uni-bonn.de</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../General-Functions/Geometry/calc_Dual.html" class="code" title="function D = calc_Dual">calc_Dual</a>	% dualizing matrix</li><li><a href="../General-Functions/Geometry/calc_Gammadual.html" class="code" title="function G = calc_Gammadual (L)">calc_Gammadual</a>	% dual Plückermatrix from Plücker vector</li><li><a href="../General-Functions/Geometry/calc_Gammadual_reduced.html" class="code" title="function [Gr , Rm] = calc_Gammadual_reduced(L)">calc_Gammadual_reduced</a>	% reduced dual Plückermatrix from Plücker vector</li><li><a href="../General-Functions/Geometry/calc_Pi.html" class="code" title="function P = calc_Pi(X)">calc_Pi</a>	% Pi-matrix from 3D-point 4-vector</li><li><a href="../General-Functions/Geometry/calc_Pidual.html" class="code" title="function P = calc_Pidual (X)">calc_Pidual</a>	% Pidual-matrix from 3D-point 4-vector</li><li><a href="../General-Functions/SUGR/Line_3D/sugr_constrain_3D_Line.html" class="code" title="function L = sugr_constrain_3D_Line(L)">sugr_constrain_3D_Line</a>	% imposes Plücker constraint for 3D lines</li><li><a href="../General-Functions/Statistics/check_CovM.html" class="code" title="function [lambda, T, F] = check_CovM(C_empir, C_theor, m, S)">check_CovM</a>	test CovM</li><li><a href="../General-Functions/Statistics/rand_gauss.html" class="code" title="function ret = rand_gauss(mu, C, n)">rand_gauss</a>	% random numbers following a multivariate Gaussian  with</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% test whether selection is necessary when using L through X constraint</span>
0002 <span class="comment">% Result: they differ, but not statistically significant</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Case o: no selection</span>
0005 <span class="comment">% Case m: with selection</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Method</span>
0008 <span class="comment">% 1. Generate true values for X and three L_i = X \wedge Y_i</span>
0009 <span class="comment">% 2. Derive theoretical covariance matrix for both cases</span>
0010 <span class="comment">% 3. Generate N_iter samples with random perturbations</span>
0011 <span class="comment">% 4. Determine solution for both cases</span>
0012 <span class="comment">% 5. determine empirical covariance matrix for both cases</span>
0013 <span class="comment">% 6. Statistically test empirical vs. theoretical covariance matrix</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Wolfgang Förstner</span>
0016 <span class="comment">% wfoerstn@uni-bonn.de</span>
0017 
0018 <span class="comment">% clear all                                                                  %#ok&lt;CLALL&gt;</span>
0019 clearvars
0020 close all
0021 clc
0022 
0023 addpath(genpath(<span class="string">'../General-Functions'</span>))
0024 
0025 S_level = 0.99; <span class="comment">% significance level</span>
0026 sigma = 0.001;  <span class="comment">% noise standard deviation for perturbation of X</span>
0027 N_iter = 500;   <span class="comment">% number of samples, can be enlarged for stronger testing</span>
0028 
0029 disp(<span class="string">'----- Test: selection of constraints for estimating X from (Li) -----'</span>)
0030 
0031 X_true = randn(4,1);             
0032 X_true = X_true/norm(X_true);         <span class="comment">% spherically normalized X</span>
0033 
0034 Y1 = randn(4,1);                      
0035 Y2 = randn(4,1);
0036 Y3 = randn(4,1);                      <span class="comment">% three other points Y_i</span>
0037 
0038 L1_true = <a href="../General-Functions/Geometry/calc_Pi.html" class="code" title="function P = calc_Pi(X)">calc_Pi</a>(X_true)*Y1;         
0039 L2_true = <a href="../General-Functions/Geometry/calc_Pi.html" class="code" title="function P = calc_Pi(X)">calc_Pi</a>(X_true)*Y2;
0040 L3_true = <a href="../General-Functions/Geometry/calc_Pi.html" class="code" title="function P = calc_Pi(X)">calc_Pi</a>(X_true)*Y3;
0041 L1_true = L1_true/norm(L1_true);
0042 L2_true = L2_true/norm(L2_true);
0043 L3_true = L3_true/norm(L3_true);      <span class="comment">% spherically normalized L_i</span>
0044 
0045 Cov1 = sigma^2*(eye(6)-<span class="keyword">...</span>
0046     [L1_true,<a href="../General-Functions/Geometry/calc_Dual.html" class="code" title="function D = calc_Dual">calc_Dual</a>*L1_true]*[L1_true,<a href="../General-Functions/Geometry/calc_Dual.html" class="code" title="function D = calc_Dual">calc_Dual</a>*L1_true]');
0047 Cov2 = sigma^2*(eye(6)-<span class="keyword">...</span>
0048     [L2_true,<a href="../General-Functions/Geometry/calc_Dual.html" class="code" title="function D = calc_Dual">calc_Dual</a>*L2_true]*[L2_true,<a href="../General-Functions/Geometry/calc_Dual.html" class="code" title="function D = calc_Dual">calc_Dual</a>*L2_true]');
0049 Cov3 = sigma^2*(eye(6)-<span class="keyword">...</span>
0050     [L3_true,<a href="../General-Functions/Geometry/calc_Dual.html" class="code" title="function D = calc_Dual">calc_Dual</a>*L3_true]*[L3_true,<a href="../General-Functions/Geometry/calc_Dual.html" class="code" title="function D = calc_Dual">calc_Dual</a>*L3_true]');
0051 Cov = [Cov1 zeros(6,12);<span class="keyword">...</span>
0052      zeros(6,6) Cov2 zeros(6,6);<span class="keyword">...</span>
0053      zeros(6,12) Cov3];             <span class="comment">% covariance matrix of L_i</span>
0054 <span class="comment">%% Case without selection; determine theoretical CovM</span>
0055 Ao = [<a href="../General-Functions/Geometry/calc_Gammadual.html" class="code" title="function G = calc_Gammadual (L)">calc_Gammadual</a>(L1_true);<span class="keyword">...</span>
0056     <a href="../General-Functions/Geometry/calc_Gammadual.html" class="code" title="function G = calc_Gammadual (L)">calc_Gammadual</a>(L2_true);<span class="keyword">...</span>
0057     <a href="../General-Functions/Geometry/calc_Gammadual.html" class="code" title="function G = calc_Gammadual (L)">calc_Gammadual</a>(L3_true)];       <span class="comment">% Coefficient matrix</span>
0058 
0059 [Uo,Do,Vo] = svd(Ao);                 <span class="comment">% SVD</span>
0060  
0061 Apo = Vo(:,1:3)*inv(Do(1:3,1:3))*Uo(:,1:3)';                                 <span class="comment">%#ok&lt;*MINV&gt;</span>
0062                                     <span class="comment">% Pseudo inverse</span>
0063                                     
0064 B = [<a href="../General-Functions/Geometry/calc_Pidual.html" class="code" title="function P = calc_Pidual (X)">calc_Pidual</a>(X_true)' zeros(4,6) zeros(4,6);<span class="keyword">...</span>
0065      zeros(4,6) <a href="../General-Functions/Geometry/calc_Pidual.html" class="code" title="function P = calc_Pidual (X)">calc_Pidual</a>(X_true)' zeros(4,6);<span class="keyword">...</span>
0066      zeros(4,6) zeros(4,6) <a href="../General-Functions/Geometry/calc_Pidual.html" class="code" title="function P = calc_Pidual (X)">calc_Pidual</a>(X_true)'];
0067                                     <span class="comment">% Jacobian</span>
0068 CovMo = Apo*(B*Cov*B')*Apo';          <span class="comment">% Theoretical CovM of estX</span>
0069 
0070 Jr = null(X_true');
0071 CovM_rr_o = Jr'*CovMo*Jr;            <span class="comment">% Theoretical CovM of estX_r</span>
0072 disp(<span class="string">'Theoretical covariance matrix of estX_r, without selection: '</span>);disp(CovM_rr_o)
0073 
0074 <span class="comment">%% Case with selection; determine theoretical CovM</span>
0075 [Gr1,M1] = <a href="../General-Functions/Geometry/calc_Gammadual_reduced.html" class="code" title="function [Gr , Rm] = calc_Gammadual_reduced(L)">calc_Gammadual_reduced</a>(L1_true);
0076 [Gr2,M2] = <a href="../General-Functions/Geometry/calc_Gammadual_reduced.html" class="code" title="function [Gr , Rm] = calc_Gammadual_reduced(L)">calc_Gammadual_reduced</a>(L2_true);
0077 [Gr3,M3] = <a href="../General-Functions/Geometry/calc_Gammadual_reduced.html" class="code" title="function [Gr , Rm] = calc_Gammadual_reduced(L)">calc_Gammadual_reduced</a>(L3_true);
0078 Am = [Gr1;Gr2;Gr3];                   <span class="comment">% Coefficient matrix</span>
0079 
0080 [Um,Dm,Vm] = svd(Am);                 <span class="comment">% SVD</span>
0081 
0082 Apm = Vm(:,1:3)*inv(Dm(1:3,1:3))*Um(:,1:3)';
0083                                     <span class="comment">% Pseudo inverse</span>
0084                                     
0085 B = [M1*<a href="../General-Functions/Geometry/calc_Pidual.html" class="code" title="function P = calc_Pidual (X)">calc_Pidual</a>(X_true)' zeros(2,6) zeros(2,6);<span class="keyword">...</span>
0086      zeros(2,6) M2*<a href="../General-Functions/Geometry/calc_Pidual.html" class="code" title="function P = calc_Pidual (X)">calc_Pidual</a>(X_true)' zeros(2,6);<span class="keyword">...</span>
0087      zeros(2,6) zeros(2,6) M3*<a href="../General-Functions/Geometry/calc_Pidual.html" class="code" title="function P = calc_Pidual (X)">calc_Pidual</a>(X_true)'];
0088                                     <span class="comment">% Jacobian</span>
0089  
0090 CovMm = Apm*(B*Cov*B')*Apm';          <span class="comment">% Theoretical CovM of estX</span>
0091 CovM_rr_m = Jr'*CovMm*Jr;            <span class="comment">% Theoretical CovM of estX_r</span>
0092 disp(<span class="string">'Theoretical covariance matrix of estX_r, with selection: '</span>);disp(CovM_rr_m)
0093 
0094 
0095 
0096 <span class="comment">%% Simulate N_iter cases</span>
0097 mean_o = zeros(3,1);
0098 mean_m = zeros(3,1);
0099 CovM_emp_o = zeros(3);
0100 CovM_emp_m = zeros(3);                <span class="comment">% initiate empirical CovM</span>
0101 
0102 <span class="keyword">for</span> iter = 1:N_iter
0103     L1 = <a href="../General-Functions/Statistics/rand_gauss.html" class="code" title="function ret = rand_gauss(mu, C, n)">rand_gauss</a>(L1_true,Cov1,1);
0104     L2 = <a href="../General-Functions/Statistics/rand_gauss.html" class="code" title="function ret = rand_gauss(mu, C, n)">rand_gauss</a>(L2_true,Cov2,1);
0105     L3 = <a href="../General-Functions/Statistics/rand_gauss.html" class="code" title="function ret = rand_gauss(mu, C, n)">rand_gauss</a>(L3_true,Cov3,1);  <span class="comment">% add noise</span>
0106     L1 = <a href="../General-Functions/SUGR/Line_3D/sugr_constrain_3D_Line.html" class="code" title="function L = sugr_constrain_3D_Line(L)">sugr_constrain_3D_Line</a>(L1);
0107     L2 = <a href="../General-Functions/SUGR/Line_3D/sugr_constrain_3D_Line.html" class="code" title="function L = sugr_constrain_3D_Line(L)">sugr_constrain_3D_Line</a>(L2);
0108     L3 = <a href="../General-Functions/SUGR/Line_3D/sugr_constrain_3D_Line.html" class="code" title="function L = sugr_constrain_3D_Line(L)">sugr_constrain_3D_Line</a>(L3);<span class="comment">% enforce Plücker constraint</span>
0109     L1 = L1/norm(L1);
0110     L2 = L2/norm(L2);
0111     L3 = L3/norm(L3);                 <span class="comment">% normalize spherically</span>
0112 
0113     <span class="comment">% without selection</span>
0114     A = [<a href="../General-Functions/Geometry/calc_Gammadual.html" class="code" title="function G = calc_Gammadual (L)">calc_Gammadual</a>(L1);<a href="../General-Functions/Geometry/calc_Gammadual.html" class="code" title="function G = calc_Gammadual (L)">calc_Gammadual</a>(L2);<a href="../General-Functions/Geometry/calc_Gammadual.html" class="code" title="function G = calc_Gammadual (L)">calc_Gammadual</a>(L3)];
0115                                     <span class="comment">% Coefficient matrix</span>
0116                                     
0117     [~,~,V] = svd(A);                 <span class="comment">% SVD</span>
0118     
0119     X_est_o = V(:,4);                <span class="comment">% algebraically best point</span>
0120     
0121     Xr_o = Jr' * X_est_o;             <span class="comment">% reduced coordinates</span>
0122     
0123     mean_o = mean_o+Xr_o;
0124     CovM_emp_o = CovM_emp_o+Xr_o*Xr_o';<span class="comment">% update empirical CovM</span>
0125     
0126     <span class="comment">% with selection, use same simulated data</span>
0127     Gr1 = <a href="../General-Functions/Geometry/calc_Gammadual_reduced.html" class="code" title="function [Gr , Rm] = calc_Gammadual_reduced(L)">calc_Gammadual_reduced</a>(L1);
0128     Gr2 = <a href="../General-Functions/Geometry/calc_Gammadual_reduced.html" class="code" title="function [Gr , Rm] = calc_Gammadual_reduced(L)">calc_Gammadual_reduced</a>(L2);
0129     Gr3 = <a href="../General-Functions/Geometry/calc_Gammadual_reduced.html" class="code" title="function [Gr , Rm] = calc_Gammadual_reduced(L)">calc_Gammadual_reduced</a>(L3);
0130     A = [Gr1;Gr2;Gr3];                
0131                                     <span class="comment">% Coefficient matrix</span>
0132     [U,D,V] = svd(A);                 <span class="comment">% SVD</span>
0133     
0134     X_est_m = V(:,4);                <span class="comment">% algebraically best X</span>
0135     Xr_m = Jr' * X_est_m;             <span class="comment">% reduced coordinates</span>
0136     mean_m = mean_m+Xr_m;
0137     CovM_emp_m = CovM_emp_m+Xr_m*Xr_m';<span class="comment">% update empirical CovM</span>
0138 <span class="keyword">end</span>
0139 mean_o = mean_o/N_iter;
0140 mean_m = mean_m/N_iter;
0141 CovM_emp_m = CovM_emp_m/N_iter;
0142 CovM_emp_o = CovM_emp_o/N_iter;        <span class="comment">% normalize CovM</span>
0143 
0144 disp(<span class="string">'Empirical covariance matrix of estX_r, with selection: '</span>);disp(CovM_emp_m)
0145 disp(<span class="string">'Empirical covariance matrix of estX_r, without selection: '</span>);disp(CovM_emp_o)
0146 
0147 disp(strcat(<span class="string">'Sample size: '</span>,num2str(N_iter)));
0148 disp(<span class="string">'Test of bias'</span>)
0149 Xo = mean_o'*inv(CovM_rr_o)*mean_o*N_iter;
0150 Xm = mean_m'*inv(CovM_rr_m)*mean_m*N_iter;
0151 Tm = chi2inv(S_level,3);
0152 To = Tm;
0153 <span class="keyword">if</span> Xo &lt; To
0154     disp(strcat(<span class="string">'Estimation without selection : '</span>,num2str(Xo),<span class="string">' &lt; ['</span>,num2str(To),<span class="string">']'</span>));
0155 <span class="keyword">else</span>  
0156     disp(strcat(<span class="string">'Estimation without selection : '</span>,num2str(Xo),<span class="string">' &gt; ['</span>,num2str(To),<span class="string">'] ***'</span>));
0157 <span class="keyword">end</span>
0158 <span class="keyword">if</span> Xm &lt; Tm
0159     disp(strcat(<span class="string">'estimation with selection    : '</span>,num2str(Xm),<span class="string">' &lt; ['</span>,num2str(Tm),<span class="string">']'</span>));
0160 <span class="keyword">else</span>  
0161     disp(strcat(<span class="string">'estimation with selection    : '</span>,num2str(Xm),<span class="string">' &gt; ['</span>,num2str(Tm),<span class="string">'] ***'</span>));
0162 <span class="keyword">end</span>
0163 disp(<span class="string">' '</span>)
0164 disp(<span class="string">'Test of empirical and theoretical CovM'</span>)
0165 [lambdam,Tm] = <a href="../General-Functions/Statistics/check_CovM.html" class="code" title="function [lambda, T, F] = check_CovM(C_empir, C_theor, m, S)">check_CovM</a>(CovM_emp_m,CovM_rr_m,N_iter,S_level);
0166 [lambdao,To] = <a href="../General-Functions/Statistics/check_CovM.html" class="code" title="function [lambda, T, F] = check_CovM(C_empir, C_theor, m, S)">check_CovM</a>(CovM_emp_o,CovM_rr_o,N_iter,S_level);
0167                                     <span class="comment">% test statistic and F-fractile</span>
0168 lo_To_lm_Tm = [lambdao,lambdam,Tm];
0169 <span class="keyword">if</span> lambdao &gt; To(1) &amp;&amp; lambdao &lt; To(2)
0170     disp(strcat(<span class="string">'estimation without selection : '</span>,num2str(lambdao),<span class="string">'     in ['</span>,num2str(To),<span class="string">']'</span>));
0171 <span class="keyword">else</span>  
0172     disp(strcat(<span class="string">'estimation without selection : '</span>,num2str(lambdao),<span class="string">' not in ['</span>,num2str(To),<span class="string">'] ***'</span>));
0173 <span class="keyword">end</span>
0174 <span class="keyword">if</span> lambdam &gt; To(1) &amp;&amp; lambdao &lt; To(2)
0175     disp(strcat(<span class="string">'estimation with selection    : '</span>,num2str(lambdam),<span class="string">'     in ['</span>,num2str(Tm),<span class="string">']'</span>));
0176 <span class="keyword">else</span>  
0177     disp(strcat(<span class="string">'estimation with selection    : '</span>,num2str(lambdam),<span class="string">' not in ['</span>,num2str(Tm),<span class="string">'] ***'</span>));
0178 <span class="keyword">end</span>
0179 
0180 
0181 
0182</pre></div>
<hr><address>Generated on Sat 21-Jul-2018 20:56:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>