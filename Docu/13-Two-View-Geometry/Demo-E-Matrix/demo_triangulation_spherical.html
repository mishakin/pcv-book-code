<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of demo_triangulation_spherical</title>
  <meta name="keywords" content="demo_triangulation_spherical">
  <meta name="description" content="% demo triangulation">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../Documentation.html">Home</a> &gt;  <a href="../Documentation.html">13-Two-View-Geometry</a> &gt; <a href="Documentation.html">Demo-E-Matrix</a> &gt; demo_triangulation_spherical.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../Documentation.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="Documentation.html">Index for 13-Two-View-Geometry\Demo-E-Matrix&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>demo_triangulation_spherical
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>% demo triangulation</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% demo triangulation

 simulate:
 X        = 4x1 vector
 [b,R]    = relative orientation
 sigma    = radial error odf direction
 max_iter = maximum iterations
 Tol      = tolerance for stopping iterations
 k        = critical value

 derive 
 u, v     = 3x1 vectors, spherically normalized

 evaluate estimated 3D point with its covaraince matrix

 Wolfgang Förstner
 wfoerstn@uni-bonn.de

 last changes: Susanne Wenzel 06/18
 wenzel@igg.uni-bonn.de</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../13-Two-View-Geometry/Functions/generate_point_pair.html" class="code" title="function [u,v] = generate_point_pair(X,b,Rot,sigma)">generate_point_pair</a>	% generate_point_pair</li><li><a href="../../General-Functions/Geometry/calc_Rot_r.html" class="code" title="function R = calc_Rot_r(r)">calc_Rot_r</a>	% Cayley rotation matrix</li><li><a href="../../General-Functions/Graphics/plot_init.html" class="code" title="function varargout = plot_init">plot_init</a>	% plot_init: initialize visualization</li><li><a href="../../General-Functions/SUGR/E-Matrix/sugr_triangulate_two_spherical_cameras.html" class="code" title="function [X_est, est_sigma_0, est_u, est_v, f] =sugr_triangulate_two_spherical_cameras(b, Rot, u, v, sigma, Tol, max_iter, k, print_option)">sugr_triangulate_two_spherical_cameras</a>	% sugr_triangulate_two_spherical_cameras</li><li><a href="../../General-Functions/SUGR/General/sugr_INIT.html" class="code" title="">sugr_INIT</a>	% sugr_INIT</li><li><a href="../../General-Functions/SUGR/Point_3D/sugr_get_Euclidean_Point_3D.html" class="code" title="function [e,Cee] = sugr_get_Euclidean_Point_3D(x)">sugr_get_Euclidean_Point_3D</a>	% Get Euclidean coordinates of 3D point with CovM</li><li><a href="../../General-Functions/Statistics/check_estimation_result.html" class="code" title="function f = check_estimation_result(R, x_true, C0, s0q_sample, x_sample, S, text)">check_estimation_result</a>	% check estimation result, PCV Sect. 4.6.8</li><li><a href="../../General-Functions/Statistics/init_rand_seed.html" class="code" title="function seed = init_rand_seed(seed)">init_rand_seed</a>	% init_rand_seed: initialize random number generation by specific seed</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% demo triangulation</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% simulate:</span>
0004 <span class="comment">% X        = 4x1 vector</span>
0005 <span class="comment">% [b,R]    = relative orientation</span>
0006 <span class="comment">% sigma    = radial error odf direction</span>
0007 <span class="comment">% max_iter = maximum iterations</span>
0008 <span class="comment">% Tol      = tolerance for stopping iterations</span>
0009 <span class="comment">% k        = critical value</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% derive</span>
0012 <span class="comment">% u, v     = 3x1 vectors, spherically normalized</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% evaluate estimated 3D point with its covaraince matrix</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Wolfgang Förstner</span>
0017 <span class="comment">% wfoerstn@uni-bonn.de</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% last changes: Susanne Wenzel 06/18</span>
0020 <span class="comment">% wenzel@igg.uni-bonn.de</span>
0021 
0022 
0023 <span class="comment">% clear all</span>
0024 clearvars
0025 close all
0026 
0027 addpath(genpath(<span class="string">'../../General-Functions'</span>))
0028 addpath(<span class="string">'../Functions'</span>)
0029 
0030 <a href="../../General-Functions/SUGR/General/sugr_INIT.html" class="code" title="">sugr_INIT</a>
0031 
0032 ss = <a href="../../General-Functions/Graphics/plot_init.html" class="code" title="function varargout = plot_init">plot_init</a>();
0033 
0034 disp(<span class="string">' --------------------------------------'</span>);
0035 disp(<span class="string">' ------ Triangulation (Alg. 21) -------'</span>);
0036 disp(<span class="string">' --------------------------------------'</span>);
0037 
0038 N_samples = 1000;
0039 
0040 sigma = 0.0001;
0041 
0042 <span class="comment">% random seed</span>
0043 <span class="comment">% init_rand      = 1;</span>
0044 init_rand      = 215741;
0045 
0046 disp([<span class="string">'Number of samples                      : '</span>, num2str(N_samples)])
0047 disp([<span class="string">'Standard deviation of directions [rad] : '</span>, num2str(sigma)])
0048 
0049 <span class="comment">%% random number intialization</span>
0050 init_randn = <a href="../../General-Functions/Statistics/init_rand_seed.html" class="code" title="function seed = init_rand_seed(seed)">init_rand_seed</a>(init_rand);
0051 disp([<span class="string">'Random seed                            : '</span> , num2str(init_randn)])
0052 
0053 <span class="comment">%%</span>
0054 fcond = 1;
0055 X_true = [[0.5,1.0,1.5]*fcond,1]';
0056 Jr_true = null(X_true');
0057 <span class="comment">% b = [1,0,0]';</span>
0058 <span class="comment">% b = [0,0,1]';</span>
0059 b = randn(3,1);
0060 b = b/norm(b);
0061 
0062 xi = X_true(4)/norm(X_true(1:3));
0063 infinite = xi &lt; 0.0001; <span class="comment">% only for plotting</span>
0064 
0065 Rot = <a href="../../General-Functions/Geometry/calc_Rot_r.html" class="code" title="function R = calc_Rot_r(r)">calc_Rot_r</a>(randn(3,1));
0066 sigma = 0.0001;
0067 max_iter = 10;
0068 Tol = 0.0001;
0069 k = 10;
0070 print_option = N_samples == 1; 
0071 
0072 X_est_all = zeros(N_samples,3);
0073 C_est_all = zeros(N_samples,3,3);
0074 s_all     = zeros(N_samples,1);
0075 
0076 <span class="comment">%% for all samples</span>
0077 t = cputime;
0078 <span class="keyword">for</span> n = 1:N_samples
0079     
0080     <span class="comment">% derive u, v</span>
0081     [u,v] = <a href="../../13-Two-View-Geometry/Functions/generate_point_pair.html" class="code" title="function [u,v] = generate_point_pair(X,b,Rot,sigma)">generate_point_pair</a>(X_true,b,Rot,sigma);
0082     
0083     <span class="comment">% E        = sugr_SkewMatrix(b)*Rot';</span>
0084     <span class="comment">% sigma_c  = sigma*sqrt(u'*E*E'*u+v'*E'*E*v);</span>
0085     <span class="comment">% cgl      = u'*E*v;</span>
0086     <span class="comment">% s_all(n) = abs(cgl)/sigma_c;</span>
0087     <span class="comment">% estimate X</span>
0088     
0089     [X_est, est_sigma_0, est_u, est_v, f] = <span class="keyword">...</span>
0090         <a href="../../General-Functions/SUGR/E-Matrix/sugr_triangulate_two_spherical_cameras.html" class="code" title="function [X_est, est_sigma_0, est_u, est_v, f] =sugr_triangulate_two_spherical_cameras(b, Rot, u, v, sigma, Tol, max_iter, k, print_option)">sugr_triangulate_two_spherical_cameras</a>(<span class="keyword">...</span>
0091         b, Rot, u, v, sigma, Tol, max_iter, k, print_option);
0092     
0093     X_est_all(n,:) = (Jr_true'*X_est.h)';
0094     
0095     s_all(n)       = est_sigma_0; 
0096 <span class="keyword">end</span>
0097 
0098 <span class="comment">%%</span>
0099 disp([<span class="string">'CPU time for '</span>, num2str(N_samples),<span class="string">' samples              : '</span>,num2str(cputime-t)]);
0100 m_X      = mean(X_est_all);    
0101 cov_X    = cov(X_est_all);
0102 disp([<span class="string">'mean reduced coordinates :'</span>, num2str(m_X)]);
0103 
0104 <span class="comment">%% Plot</span>
0105 <span class="comment">% plotting of not too far</span>
0106 <span class="keyword">if</span> ~infinite
0107     figure(<span class="string">'name'</span>,<span class="string">'est.cov'</span>,<span class="string">'Color'</span>,<span class="string">'w'</span>, <span class="string">'Position'</span>,[100 0.52*ss(2) ss(1)/3 0.4*ss(2)])
0108     hold on
0109     plot3(X_true(1),X_true(2),X_true(3),<span class="string">'or'</span>);
0110     plot3([0,b(1)],[0,b(2)],[0,b(3)],<span class="string">'-b'</span>,<span class="string">'LineWidth'</span>,3);
0111     plot3([0,X_true(1)],[0,X_true(2)],[0,X_true(3)],<span class="string">'--r'</span>,<span class="string">'LineWidth'</span>,2);
0112     plot3([b(1),X_true(1)],[b(2),X_true(2)],[b(3),X_true(3)],<span class="string">'--r'</span>,<span class="string">'LineWidth'</span>,2);
0113     box on
0114     title(<span class="string">'estimated covariance matrix'</span>)
0115     axis equal
0116 
0117     Xemp.h = X_est.h;
0118     Xemp.Crr = cov_X;
0119     [~,Cee] = <a href="../../General-Functions/SUGR/Point_3D/sugr_get_Euclidean_Point_3D.html" class="code" title="function [e,Cee] = sugr_get_Euclidean_Point_3D(x)">sugr_get_Euclidean_Point_3D</a>(Xemp);
0120     [R,D] = eig(Cee);
0121 
0122     f = 0.4/sqrt(D(1,1));
0123     [X,Y,Z] = ellipsoid(0,0,0,sqrt(D(1,1))*f,sqrt(D(2,2))'*f,sqrt(D(3,3))*f);
0124     K = [X(:),Y(:),Z(:)]*R'+ones(441,1)*X_true(1:3)';
0125 
0126     surfl(reshape(K(:,1),21,21), reshape(K(:,2),21,21), reshape(K(:,3),21,21))
0127     colormap cool <span class="comment">%copper</span>
0128     axis equal
0129 
0130     figure(<span class="string">'name'</span>,<span class="string">'true.cov'</span>,<span class="string">'Color'</span>,<span class="string">'w'</span>, <span class="string">'Position'</span>,[300+ss(1)/3 0.52*ss(2) ss(1)/3 0.4*ss(2)])
0131     hold on
0132     plot3(X_true(1),X_true(2),X_true(3),<span class="string">'or'</span>);
0133     plot3([0,b(1)],[0,b(2)],[0,b(3)],<span class="string">'-b'</span>,<span class="string">'LineWidth'</span>,3);
0134     plot3([0,X_true(1)],[0,X_true(2)],[0,X_true(3)],<span class="string">'--r'</span>,<span class="string">'LineWidth'</span>,2);
0135     plot3([b(1),X_true(1)],[b(2),X_true(2)],[b(3),X_true(3)],<span class="string">'--r'</span>,<span class="string">'LineWidth'</span>,2);
0136     box on
0137     title(<span class="string">'true covariance matrix'</span>)
0138     axis equal
0139         
0140     [~,Cee] = <a href="../../General-Functions/SUGR/Point_3D/sugr_get_Euclidean_Point_3D.html" class="code" title="function [e,Cee] = sugr_get_Euclidean_Point_3D(x)">sugr_get_Euclidean_Point_3D</a>(X_est);
0141     [R,D] = eig(Cee);
0142 
0143     f = 0.4/sqrt(D(1,1));
0144 
0145     [X,Y,Z] = ellipsoid(0,0,0,sqrt(D(1,1))*f,sqrt(D(2,2))'*f,sqrt(D(3,3))*f);
0146     K = [X(:),Y(:),Z(:)]*R'+ones(441,1)*X_true(1:3)';
0147 
0148     surfl(reshape(K(:,1),21,21), reshape(K(:,2),21,21), reshape(K(:,3),21,21))
0149     colormap copper
0150     axis equal
0151 
0152 <span class="keyword">end</span>
0153 
0154 <span class="comment">%% Analyse</span>
0155 <a href="../../General-Functions/Statistics/check_estimation_result.html" class="code" title="function f = check_estimation_result(R, x_true, C0, s0q_sample, x_sample, S, text)">check_estimation_result</a>(1,zeros(3,1),X_est.Crr,s_all.^2,X_est_all,0.999,<span class="string">'Triangulation'</span>);
0156 set(gcf,<span class="string">'Position'</span>,[100 20 ss(1)/2 0.4*ss(2)])
0157</pre></div>
<hr><address>Generated on Sat 21-Jul-2018 20:56:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>