<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of sugr_estimation_algebraic_Homography_2D_from_point_pairs</title>
  <meta name="keywords" content="sugr_estimation_algebraic_Homography_2D_from_point_pairs">
  <meta name="description" content="% Algebraic estimation of 2D homography from point pairs,">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../Documentation.html">Home</a> &gt;  <a href="../../Documentation.html">General-Functions</a> &gt; <a href="#">SUGR</a> &gt; <a href="Documentation.html">Homography_2D</a> &gt; sugr_estimation_algebraic_Homography_2D_from_point_pairs.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../Documentation.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="Documentation.html">Index for General-Functions\SUGR\Homography_2D&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>sugr_estimation_algebraic_Homography_2D_from_point_pairs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Algebraic estimation of 2D homography from point pairs,</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function H = sugr_estimation_algebraic_Homography_2D_from_point_pairs(P) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Algebraic estimation of 2D homography from point pairs, 
 assuming independent observations
 and conditioned points

 H = sugr_estimation_algebraic_Homography_2D_from_point_pairs(P) 

 P contains point pairs
 P.h = [X,Y]
 * X = N x 3 matrix if points 
 * Y = N x 3 matrix if points
 P.Crr = N x 2 x 2 contains reduced covariance matrix
 

 0 != S^s(y) * H * x 
    = Rm(y) * S(y) * H * x 
    = Rm(y) * S'(H x) * y
    = Rm(y) * S(y) * (x' kron eye(3)) h 

 H.H   = estimated homography with uncertainty, 
         using algebraic minimization, thus neglecting the accuracy
 H.Crr = CovM of reduced parameters, derived by variance propagation


 Wolfgang Förstner
 wfoerstn@uni-bonn.de

 wf 2/2010</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../General-Functions/Geometry/calc_S.html" class="code" title="function S = calc_S(x)">calc_S</a>	% skew matrix of 3-vector</li><li><a href="../../../General-Functions/Geometry/calc_S_reduced.html" class="code" title="function [S , R] = calc_S_reduced(x)">calc_S_reduced</a>	% Skew matrix with independent selected rows</li><li><a href="sugr_Homography_2D.html" class="code" title="function Homography_2D = sugr_Homography_2D(a1,a2)">sugr_Homography_2D</a>	% create 2D homography</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../10-Uncertain-Geometry/Demo-Homography/demo_estimate_2D_homography_from_point_pairs.html" class="code" title="">demo_estimate_2D_homography_from_point_pairs</a>	% demo_estimate_2D_homography_from_point_pairs</li><li><a href="../../../10-Uncertain-Geometry/Functions/determine_Homography_2D_from_two_images.html" class="code" title="function [H,X] = determine_Homography_2D_from_two_images(Image_l,Image_r,readX)">determine_Homography_2D_from_two_images</a>	demo_h_determine_homography_from_two_images: read/interactively determine homography</li><li><a href="../../../10-Uncertain-Geometry/Functions/h_transfer_grid.html" class="code" title="function h_transfer_grid(H,CP,Image_l,Image_r,magnification,grid_out)">h_transfer_grid</a>	demo_h_transfer_grid: transfer point in demo_homography</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Algebraic estimation of 2D homography from point pairs,</span>
0002 <span class="comment">% assuming independent observations</span>
0003 <span class="comment">% and conditioned points</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% H = sugr_estimation_algebraic_Homography_2D_from_point_pairs(P)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% P contains point pairs</span>
0008 <span class="comment">% P.h = [X,Y]</span>
0009 <span class="comment">% * X = N x 3 matrix if points</span>
0010 <span class="comment">% * Y = N x 3 matrix if points</span>
0011 <span class="comment">% P.Crr = N x 2 x 2 contains reduced covariance matrix</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% 0 != S^s(y) * H * x</span>
0015 <span class="comment">%    = Rm(y) * S(y) * H * x</span>
0016 <span class="comment">%    = Rm(y) * S'(H x) * y</span>
0017 <span class="comment">%    = Rm(y) * S(y) * (x' kron eye(3)) h</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% H.H   = estimated homography with uncertainty,</span>
0020 <span class="comment">%         using algebraic minimization, thus neglecting the accuracy</span>
0021 <span class="comment">% H.Crr = CovM of reduced parameters, derived by variance propagation</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% Wolfgang Förstner</span>
0025 <span class="comment">% wfoerstn@uni-bonn.de</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% wf 2/2010</span>
0028 
0029 <a name="_sub0" href="#_subfunctions" class="code">function H = sugr_estimation_algebraic_Homography_2D_from_point_pairs(P)</a>
0030 
0031 <span class="comment">% pair coordinates</span>
0032 Ph   = P.h;
0033 <span class="comment">% pair CovM reduced</span>
0034 PCrr = P.Crr;
0035 <span class="comment">% homogeneous coordinates</span>
0036 X = Ph(:,1:3);
0037 Y = Ph(:,4:6);
0038 <span class="comment">% number of point pairs</span>
0039 N = size(X,1);
0040 
0041 <span class="comment">%%</span>
0042 <span class="comment">% estimate H algebraically</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% build coefficient matrix</span>
0045 A = zeros(2*N,9);
0046 <span class="keyword">for</span> n = 1:N
0047     <span class="comment">% select 2x3 skew matrix</span>
0048     [Ssy,~] = <a href="../../../General-Functions/Geometry/calc_S_reduced.html" class="code" title="function [S , R] = calc_S_reduced(x)">calc_S_reduced</a>(Y(n,:)');
0049     <span class="comment">% Kronecker 3x9 -matrix</span>
0050     K  = [X(n,1)*eye(3), X(n,2)*eye(3) X(n,3)*eye(3)];
0051     <span class="comment">% 2x9 part of A</span>
0052     A(2*n-1:2*n,:)  = Ssy * K; 
0053 <span class="keyword">end</span>
0054 
0055 <span class="comment">% partition</span>
0056 N_rows = size(A,1);
0057 <span class="keyword">if</span> N_rows == 8
0058     h = null(A);
0059     A_plus = A'/(A*A');
0060 <span class="keyword">else</span>
0061     [U,D,V] = svd(A,<span class="string">'econ'</span>);
0062     <span class="comment">% find algebraically best solution</span>
0063     h        = V(:,9);
0064     <span class="comment">% determine A+ = pseudo inverse of A with last singular value = 0</span>
0065     Di       = inv(D+eps*eye(9));
0066     Di(9,9)  = 0;
0067     A_plus   = V * Di * U';
0068 <span class="keyword">end</span>
0069 <span class="comment">% choose unique sign (largest element &gt; 0)</span>
0070 [~,imax] = max(abs(h));
0071 h        = h * sign(h(imax));
0072 He       = reshape(h,3,3);
0073 He=He/(abs(det(He))^(1/3));
0074 
0075 
0076 <span class="comment">%% determine covariance matrix Chh = A^+ Cgg A^+'</span>
0077 
0078 <span class="comment">% determine Cgg of residuals g of constraints from</span>
0079 <span class="comment">% S^s(y) H x                        = g</span>
0080 <span class="comment">% Ry Sy  H x                        = g</span>
0081 <span class="comment">% d(Ry Sy H x)                      = d(g)</span>
0082 <span class="comment">% Ry Sy H dx     - Ry S(H x) dy     = dg</span>
0083 <span class="comment">% S^sy  H Jr dxr - Ry S(H x) Jr dyr = dg</span>
0084 <span class="comment">%</span>
0085 
0086 <span class="comment">%Cxyxy = sparse(zeros(2*N,2*N));</span>
0087 Cxyxy = spalloc(2*N,2*N,2*N);
0088 <span class="keyword">for</span> n=1:N
0089     <span class="comment">% VarProp for g</span>
0090     [Ssy,Ry] = <a href="../../../General-Functions/Geometry/calc_S_reduced.html" class="code" title="function [S , R] = calc_S_reduced(x)">calc_S_reduced</a>(Y(n,:));
0091     J_x = + Ssy * He * null(X(n,:));
0092     J_y = - Ry * <a href="../../../General-Functions/Geometry/calc_S.html" class="code" title="function S = calc_S(x)">calc_S</a>(He * X(n,:)') *  null(Y(n,:));
0093     <span class="comment">% effect of both</span>
0094     J = [J_x J_y];  <span class="comment">% 2 x 4 Jacobian res/pr = [res/xr res/yr]</span>
0095     Cxyxy(2*n-1:2*n,2*n-1:2*n)  = Cxyxy(2*n-1:2*n,2*n-1:2*n) <span class="keyword">...</span>
0096         + J * squeeze(PCrr(n,:,:)) * J';                                    <span class="comment">%#ok&lt;SPRIX&gt;</span>
0097 <span class="keyword">end</span>
0098 Chh = A_plus * Cxyxy * A_plus';
0099 
0100 H = <a href="sugr_Homography_2D.html" class="code" title="function Homography_2D = sugr_Homography_2D(a1,a2)">sugr_Homography_2D</a>(He,Chh);</pre></div>
<hr><address>Generated on Sat 21-Jul-2018 20:56:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>